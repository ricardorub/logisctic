<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Inventario</h1>
        <div class="mb-3">
            <input type="file" id="importFile" class="form-control" style="display: none;">
            <button id="importBtn" class="btn btn-primary">Importar</button>
            <button id="exportBtn" class="btn btn-success">Exportar</button>
            <button id="clearBtn" class="btn btn-danger">Limpiar</button>
        </div>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>SKU</th>
                    <th>Producto</th>
                    <th>Proveedor</th>
                    <th>Fecha de pedido</th>
                    <th>Fecha de recepción</th>
                    <th>ID del pedido stock</th>
                    <th>Ventas</th>
                    <th>Duración</th>
                    <th>Número de pedidos</th>
                    <th>Tiempo de entrega</th>
                    <th>Cobertura</th>
                    <th>Frecuencia</th>
                </tr>
            </thead>
            <tbody id="inventario-table-body">
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadInventario();

            const importBtn = document.getElementById('importBtn');
            const importFile = document.getElementById('importFile');
            const exportBtn = document.getElementById('exportBtn');
            const clearBtn = document.getElementById('clearBtn');

            importBtn.addEventListener('click', () => {
                importFile.click();
            });

            importFile.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const formData = new FormData();
                    formData.append('file', file);

                    fetch('/api/inventario/import', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadInventario();
                        } else {
                            alert('Error al importar el archivo: ' + data.error);
                        }
                    });
                }
            });

            exportBtn.addEventListener('click', () => {
                window.location.href = '/api/inventario/export';
            });

            clearBtn.addEventListener('click', () => {
                if (confirm('¿Está seguro de que desea borrar todos los datos?')) {
                    fetch('/api/inventario/clear', {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadInventario();
                        }
                    });
                }
            });
        });

        function loadInventario() {
            fetch('/api/inventario')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('inventario-table-body');
                    tableBody.innerHTML = '';
                    data.forEach(item => {
                        const row = `
                            <tr>
                                <td>${item.item}</td>
                                <td>${item.sku}</td>
                                <td>${item.producto}</td>
                                <td>${item.proveedor}</td>
                                <td>${item.fecha_pedido}</td>
                                <td>${item.fecha_recepcion}</td>
                                <td>${item.id_pedido_stock}</td>
                                <td>${item.ventas}</td>
                                <td>${item.duracion}</td>
                                <td>${item.numero_pedidos}</td>
                                <td>${item.tiempo_entrega}</td>
                                <td>${item.cobertura}</td>
                                <td>${item.frecuencia}</td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                });
        }
    </script>
</body>
</html>
